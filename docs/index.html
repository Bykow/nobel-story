<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <link rel="apple-touch-icon" sizes="76x76" href="./assets/img/apple-icon.png">
    <link rel="icon" type="image/png" href="./assets/img/favicon.png">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>Now Ui Kit by Creative Tim</title>
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no' name='viewport' />
    <!--     Fonts and icons     -->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700,200" rel="stylesheet" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" />
    <!-- CSS Files -->
    <link href="./assets/css/bootstrap.min.css" rel="stylesheet" />
    <link href="./assets/css/now-ui-kit.css?v=1.1.0" rel="stylesheet" />
    <!-- CSS Just for demo purpose, don't include it in your project -->
    <link href="./assets/css/demo.css" rel="stylesheet" />
</head>

<body class="index-page sidebar-collapse">
<div class="wrapper">
    <div class="page-header clear-filter" filter-color="orange">
        <div class="page-header-image" data-parallax="true" style="background-image: url('./assets/img/nobel-header.jpg');">
        </div>
        <div class="container">
            <div class="content-center brand">
                <img class="n-logo" src="./assets/img/dataset-original.png" alt="Thumbnail Image" class="rounded-circle img-raised">
                <h1 class="h1-seo">Nobel Prizes</h1>
                <h3>A digital story about excellence</h3>
            </div>
            <h6 class="category category-absolute">
                Coded by
                <a href="https://www.creative-tim.com" target="_blank">
                    <img src="./assets/img/creative-tim-white-slim2.png" class="creative-tim-logo" />
                </a>. Used by
                <a href="https://github.com/Bykow" target="_blank">
                    Lawrence Stalder
                </a>
            </h6>
        </div>
    </div>
    <div class="main">
        <div class="container">
            <svg id="map" width=100% height=540px font-family="sans-serif" font-size="10" text-anchor="middle" ></svg>
            <div id="sliderDouble" class="slider slider-primary"></div>
        </div>
        <div class="container">
            <p></p>
        </div>
        <script src="https://d3js.org/d3.v4.min.js"></script>
        <script src="https://d3js.org/topojson.v1.min.js"></script>
        <script src='//alexmacy.github.io/crossfilter/crossfilter.v1.min.js'></script>
        <script>
          var width = 960,
            height = 500;

          var svg = d3.select("#map").append("svg")
            .attr("width", width)
            .attr("height", height);

          var nobelPerCountry = d3.map();

          var domain = [0, 1, 2, 3, 4, 5, 7, 10, 20, 30, 50, 150, 300];
          var generator = d3.scaleLinear()
            .domain([0,(domain.length-1)/2,domain.length-1])
            .range([
              d3.hsl(0.00,0.00,0.57),
              d3.hsl(0.55,1.00,0.50)]
            )
            .interpolate(d3.interpolateCubehelix);

          var range = d3.range(domain.length).map(generator);

          var color = d3.scaleThreshold()
            .domain(domain)
            .range(range);

          var projection = d3.geoEquirectangular();

          var path = d3.geoPath().projection(projection);

          var div = d3.select("body").append("div")
            .attr("class", "tooltip")
            .style("background-color","grey")
            .style("opacity", 0.6);

          var nobel = crossfilter(),
            per_country = nobel.dimension(d => d.country),
            per_countries = per_country.group(),
            per_year = nobel.dimension(d => d.year);

          d3.queue()
            .defer(d3.json, "./assets/topojson/world/countries.json")
            .defer(d3.csv, "./data/out.csv", function(d) {
              for(var propertyName in d) {
                if (propertyName == "id" || propertyName == "year") {
                  d[propertyName] = +d[propertyName];
                } else {
                  continue;
                }
              }
              nobel.add([d]);
              nobelPerCountry.set(d.country, d.year);
            })
            .await(ready);

          function ready(error, map) {
            svg.append("g")
              .attr("class", "country")
              .selectAll("path")
              .data(topojson.feature(map, map.objects.units).features)
              .enter().append("path")
              .attr("d", path)
              .style("opacity", 0.8);

            initSlider();
            render();

            function render(){
              let temp = per_countries.all().reduce((obj, c) => obj.set(c.key, c.value), d3.map());
              svg.attr("class", "country")
                .selectAll("path")
                .attr("fill", function(d) {
                  if (!temp.has(d.id) || temp.get(d.id) === 0) {
                    return "grey";
                  }
                  return color(temp.get(d.id));
                })
                .on("mouseover", function(d) {
                  d3.select(this).transition().duration(300).style("opacity", 1);
                  div.transition()
                    .duration(200)
                    .style("opacity", 1);
                  div.html(d.id + "<br/>" + (temp.has(d.id) ? temp.get(d.id): "0"))
                    .style("left", (d3.event.pageX) + "px")
                    .style("top", (d3.event.pageY - 28) + "px");
                })
                .on("mouseout", function() {
                  d3.select(this).transition().duration(300).style("opacity", 0.8);
                  div.transition()
                    .duration(500)
                    .style("opacity", 0);
                });
            }

            function initSlider() {
              let values;
              let min = 1900,
                max = 2020;

              let slider = document.getElementById("sliderDouble");

              noUiSlider.create(slider, {
                start: [1900, 2020],
                connect: true,
                range: {
                  min: min,
                  max: max
                },
                pips: {
                  mode: "positions",
                  values: [0,25,50,75,100],
                  density: 3
                },
                format: {
                  to: function ( value ) {
                    return Math.round(value);
                  },
                  from: function ( value ) {
                    return Math.round(value);
                  }
                },
                tooltips: [wNumb({ decimals: 0 }), wNumb({ decimals: 0 })],
                animate: true,
                animationDuration: 300,
              });

              slider.noUiSlider.on("slide", function(){
                values = slider.noUiSlider.get();
                per_year.filter(values);
                render();
              });
            }
          }
        </script>

        <!--  End Modal -->
        <footer class="footer" data-background-color="black">
            <div class="container">
                <nav>
                    <ul>
                        <li>
                            <a href="https://www.creative-tim.com">
                                Creative Tim
                            </a>
                        </li>
                        <li>
                            <a href="http://presentation.creative-tim.com">
                                About Us
                            </a>
                        </li>
                        <li>
                            <a href="http://blog.creative-tim.com">
                                Blog
                            </a>
                        </li>
                        <li>
                            <a href="https://github.com/creativetimofficial/now-ui-kit/blob/master/LICENSE.md">
                                MIT License
                            </a>
                        </li>
                    </ul>
                </nav>
                <div class="copyright">
                    &copy;
                    <script>
                      document.write(new Date().getFullYear())
                    </script>, Designed by
                    <a href="http://www.invisionapp.com" target="_blank">Invision</a>. Coded by
                    <a href="https://www.creative-tim.com" target="_blank">Creative Tim</a>.
                </div>
            </div>
        </footer>
    </div>
</body>
<!--   Core JS Files   -->
<script src="./assets/js/core/jquery.3.2.1.min.js" type="text/javascript"></script>
<script src="./assets/js/core/popper.min.js" type="text/javascript"></script>
<script src="./assets/js/core/bootstrap.min.js" type="text/javascript"></script>
<!--  Plugin for the Sliders, full documentation here: http://refreshless.com/nouislider/ -->
<script src="./assets/js/plugins/nouislider.min.js" type="text/javascript"></script>
<script src="./assets/js/plugins/wNumb.js" type="text/javascript"></script>


</html>